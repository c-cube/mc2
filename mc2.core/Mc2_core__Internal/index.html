<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mc2_core__Internal (mc2.core.Mc2_core__Internal)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">mc2.core</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Mc2_core__Internal</span></h1></header><p>mSAT core</p><p>This is the core of msat, containing the code doing the actual solving.
This module is based on mini-sat, and as such the solver heavily uses mutation,
which makes using it direclty kinda tricky (some exceptions can be raised
at surprising times, mutating is dangerous for maintaining invariants, etc...).</p><h3>Solving facilities</h3><div class="spec exception" id="exception-Unsat"><a href="#exception-Unsat" class="anchor"></a><div class="def exception"><code><span class="keyword">exception </span></code><code><span class="exception">Unsat</span></code></div><div class="doc"></div></div><div class="spec exception" id="exception-UndecidedLit"><a href="#exception-UndecidedLit" class="anchor"></a><div class="def exception"><code><span class="keyword">exception </span></code><code><span class="exception">UndecidedLit</span><span class="keyword"> of </span><a href="../Mc2_core__/Solver_types/index.html#type-term">Mc2_core__.Solver_types.term</a></code></div><div class="doc"></div></div><div class="spec exception" id="exception-Out_of_time"><a href="#exception-Out_of_time" class="anchor"></a><div class="def exception"><code><span class="keyword">exception </span></code><code><span class="exception">Out_of_time</span></code></div><div class="doc"></div></div><div class="spec exception" id="exception-Out_of_space"><a href="#exception-Out_of_space" class="anchor"></a><div class="def exception"><code><span class="keyword">exception </span></code><code><span class="exception">Out_of_space</span></code></div><div class="doc"></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The core solver structure</p></div></div><div class="spec val" id="val-create"><a href="#val-create" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>create : unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Create a solver</p></div></div><div class="spec val" id="val-add_plugin"><a href="#val-add_plugin" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_plugin : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core/Plugin/Factory/index.html#type-t">Mc2_core.Plugin.Factory.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core/Plugin/index.html#type-t">Mc2_core.Plugin.t</a></code></div><div class="doc"><p><code class="code">add_plugin s f</code> creates a new plugin, stores it into <code class="code">s</code>,
and returns it.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Failure</span>: if all plugin IDs have been allocated</li></ul></div></div><div class="spec val" id="val-plugins"><a href="#val-plugins" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>plugins : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core/Plugin/index.html#type-t">Mc2_core.Plugin.t</a> Sequence.t</code></div><div class="doc"></div></div><div class="spec val" id="val-get_plugin"><a href="#val-get_plugin" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get_plugin : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-plugin_id">Mc2_core__.Solver_types.plugin_id</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core/Plugin/index.html#type-t">Mc2_core.Plugin.t</a></code></div><div class="doc"><p>Get the plugin from its ID</p></div></div><div class="spec val" id="val-services"><a href="#val-services" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>services : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core/Service/Registry/index.html#type-t">Mc2_core.Service.Registry.t</a></code></div><div class="doc"><p>Service registry</p></div></div><div class="spec val" id="val-get_service"><a href="#val-get_service" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get_service : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../Mc2_core/Service/Key/index.html#type-t">Mc2_core.Service.Key.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> option</code></div><div class="doc"><p>Obtain a service by its key</p></div></div><div class="spec val" id="val-get_service_exn"><a href="#val-get_service_exn" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get_service_exn : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../Mc2_core/Service/Key/index.html#type-t">Mc2_core.Service.Key.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p>Obtain a service by its key</p></div></div><div class="spec val" id="val-actions"><a href="#val-actions" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>actions : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-actions">Mc2_core__.Solver_types.actions</a></code></div><div class="doc"><p>Actions available to plugins</p></div></div><div class="spec val" id="val-iter_terms"><a href="#val-iter_terms" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>iter_terms : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-term">Mc2_core__.Solver_types.term</a> Sequence.t</code></div><div class="doc"><p>Iterate on all terms known to plugins.
Used for checking all variables to assign, and for garbage collection.</p></div></div><div class="spec val" id="val-solve"><a href="#val-solve" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>solve : ?&#8288;gc:bool <span class="keyword">&#8209;&gt;</span> ?&#8288;restarts:bool <span class="keyword">&#8209;&gt;</span> ?&#8288;time:float <span class="keyword">&#8209;&gt;</span> ?&#8288;memory:float <span class="keyword">&#8209;&gt;</span> ?&#8288;progress:bool <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Try and solves the current set of assumptions.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">time</span>: limit, in seconds, measured with <code class="code">Sys.time()</code></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">memory</span>: number of words in the heap</li><li><span class="at-tag return">Returns</span> () if the current set of clauses is satisfiable</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Unsat</span>: if a toplevel conflict is found</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Out_of_time</span>: if out of time</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Out_of_space</span>: if out of space</li></ul></div></div><div class="spec val" id="val-assume"><a href="#val-assume" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>assume : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;tag:int <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-atom">Mc2_core__.Solver_types.atom</a> list list <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Add the list of clauses to the current set of assumptions.
Modifies the sat solver state in place.</p></div></div><div class="spec val" id="val-add_term"><a href="#val-add_term" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_term : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-term">Mc2_core__.Solver_types.term</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Add a new generalized variable (i.e term) to the solver. This term will
be decided on at some point during solving, wether it appears
in clauses or not.</p></div></div><div class="spec val" id="val-push"><a href="#val-push" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>push : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Create a decision level for local assumptions.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Unsat</span>: if a conflict is detected in the current state.</li></ul></div></div><div class="spec val" id="val-pop"><a href="#val-pop" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pop : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Pop a decision level for local assumptions.</p></div></div><div class="spec val" id="val-local"><a href="#val-local" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>local : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-atom">Mc2_core__.Solver_types.atom</a> list <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Add local assumptions</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">assumptions</span>: list of additional local assumptions to make,
removed after the callback returns a value</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if no levels were <a href="index.html#val-push">push</a>ed</li></ul></div></div><h3>Proofs and Models</h3><div class="spec val" id="val-eval"><a href="#val-eval" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>eval : <a href="../Mc2_core__/Solver_types/index.html#type-atom">Mc2_core__.Solver_types.atom</a> <span class="keyword">&#8209;&gt;</span> bool</code></div><div class="doc"><p>Returns the valuation of a term in the current state
of the sat solver.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">UndecidedLit</span>: if the literal is not decided</li></ul></div></div><div class="spec val" id="val-eval_level"><a href="#val-eval_level" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>eval_level : <a href="../Mc2_core__/Solver_types/index.html#type-atom">Mc2_core__.Solver_types.atom</a> <span class="keyword">&#8209;&gt;</span> bool<span class="keyword"> * </span>int</code></div><div class="doc"><p>Return the current assignement/evaluation of the boolean term,
as well as its decision level. If the level is 0, then it is necessary for
the atom to have this value; otherwise it is due to choices
that can potentially be backtracked.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">UndecidedLit</span>: if the literal is not decided not calculable</li></ul></div></div><div class="spec val" id="val-model"><a href="#val-model" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>model : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-assignment_view">Mc2_core__.Solver_types.assignment_view</a> list</code></div><div class="doc"><p>Returns the model found if the term is satisfiable.</p></div></div><div class="spec val" id="val-check"><a href="#val-check" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>check : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (unit, string) Pervasives.result</code></div><div class="doc"><p>Check the satisfiability of the current model. Only has meaning
if the solver finished proof search and has returned <code class="code">Sat</code>.</p></div></div><div class="spec type" id="type-proof"><a href="#type-proof" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>proof</code><code><span class="keyword"> = </span><a href="../Mc2_core/Proof/index.html#type-t">Mc2_core.Proof.t</a></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-unsat_conflict"><a href="#val-unsat_conflict" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>unsat_conflict : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-clause">Mc2_core__.Solver_types.clause</a> option</code></div><div class="doc"><p>Returns the unsat clause found at the toplevel, if it exists (i.e if
<code class="code">solve</code> has raised <code class="code">Unsat</code>)</p></div></div><h3>Internal data</h3><p>
These functions expose some internal data stored by the solver, as such
great care should be taken to ensure not to mess with the values returned.</p><div class="spec val" id="val-trail"><a href="#val-trail" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>trail : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-trail">Mc2_core__.Solver_types.trail</a></code></div><div class="doc"><p>Returns the current trail.
<b>DO NOT MUTATE</b></p></div></div><div class="spec val" id="val-hyps"><a href="#val-hyps" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>hyps : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-clause">Mc2_core__.Solver_types.clause</a> <a href="../Mc2_core__/Vec/index.html#type-t">Mc2_core__.Vec.t</a></code></div><div class="doc"><p>Returns the vector of assumptions used by the solver. May be slightly different
from the clauses assumed because of top-level simplification of clauses.
<b>DO NOT MUTATE</b></p></div></div><div class="spec val" id="val-temp"><a href="#val-temp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>temp : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-clause">Mc2_core__.Solver_types.clause</a> <a href="../Mc2_core__/Vec/index.html#type-t">Mc2_core__.Vec.t</a></code></div><div class="doc"><p>Returns the clauses coreesponding to the local assumptions.
All clauses in this vec are assured to be unit clauses.
<b>DO NOT MUTATE</b></p></div></div><div class="spec val" id="val-history"><a href="#val-history" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>history : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mc2_core__/Solver_types/index.html#type-clause">Mc2_core__.Solver_types.clause</a> <a href="../Mc2_core__/Vec/index.html#type-t">Mc2_core__.Vec.t</a></code></div><div class="doc"><p>Returns the history of learnt clauses, with no guarantees on order.
<b>DO NOT MUTATE</b></p></div></div><div class="spec val" id="val-pp_stats"><a href="#val-pp_stats" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_stats : <a href="index.html#type-t">t</a> CCFormat.printer</code></div><div class="doc"></div></div><div class="spec val" id="val-clear_progress"><a href="#val-clear_progress" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>clear_progress : unit <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Clear progress bar</p></div></div></body></html>